openapi: 3.0.3

info:
  title: Butler Shared API - Debug Logging Service
  version: 1.0.0
  description: |
    API for managing debug logging in the Butler system.
    Debug logging can be dynamically enabled/disabled at runtime for troubleshooting.
  contact:
    name: Platform Team
    email: platform-team@example.com

servers:
  - url: https://api.production.example.com
    description: Production
  - url: https://api.staging.example.com
    description: Staging
  - url: http://localhost:8080
    description: Local

security:
  - bearerAuth: []

tags:
  - name: Debug Logging
    description: Control debug logging behavior

paths:
  /api/butler_shared/v1/logging/debug/disable:
    post:
      operationId: DISABLE-DEBUG-LOGGING
      tags:
        - Debug Logging
      summary: Disable debug logging
      description: |
        Disables debug logging and returns the system to normal logging levels.

        **Permissions:** `logging:write` or `admin`

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - reason
              properties:
                reason:
                  type: string
                  description: Reason for disabling (for audit trail)
                  minLength: 10
                  maxLength: 500
                  example: "Troubleshooting session completed"
                source:
                  type: string
                  description: Source system requesting this operation
                  example: "monitoring-dashboard"
                user_id:
                  type: string
                  description: ID of user performing this operation
                  example: "user-12345"
            example:
              reason: "Debug session completed - issue resolved"
              source: "ops-dashboard"
              user_id: "user-12345"

      responses:
        "200":
          description: Debug logging successfully disabled
          content:
            application/json:
              schema:
                type: object
                required:
                  - status
                  - timestamp
                properties:
                  status:
                    type: string
                    enum: [success, already_disabled]
                    example: "success"
                  message:
                    type: string
                    example: "Debug logging disabled successfully"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-11-01T10:30:00Z"
                  previous_state:
                    type: object
                    description: Info about the previous debug session
                    properties:
                      enabled_at:
                        type: string
                        format: date-time
                      enabled_by:
                        type: string
                      duration_seconds:
                        type: integer
              example:
                status: "success"
                message: "Debug logging disabled successfully"
                timestamp: "2025-11-01T10:30:00Z"
                previous_state:
                  enabled_at: "2025-11-01T09:00:00Z"
                  enabled_by: "user-12345"
                  duration_seconds: 5400

        "400":
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                error: "validation_error"
                message: "Field 'reason' is required"

        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

        "403":
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

  /api/butler_shared/v1/logging/debug/enable:
    post:
      operationId: ENABLE-DEBUG-LOGGING
      tags:
        - Debug Logging
      summary: Enable debug logging
      description: |
        Enables debug logging with optional auto-disable after TTL expires.

        **Permissions:** `logging:write` or `admin`

        **Note:** Debug logging may impact system performance.

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ttl:
                  type: integer
                  description: Auto-disable after this many seconds (optional)
                  minimum: 60
                  maximum: 86400
                  example: 3600
                reason:
                  type: string
                  description: Reason for enabling (recommended for audit)
                  minLength: 10
                  maxLength: 500
                  example: "Investigating API performance issue"
                level:
                  type: string
                  description: Debug level
                  enum: [debug, trace]
                  default: debug
                user_id:
                  type: string
                  description: ID of user enabling debug logging
                  example: "user-54321"
            examples:
              with_ttl:
                summary: With 1-hour auto-disable
                value:
                  ttl: 3600
                  reason: "Investigating slow API responses"
                  level: "debug"
                  user_id: "user-54321"
              without_ttl:
                summary: Manual disable required
                value:
                  reason: "Extended troubleshooting session"
                  level: "debug"

      responses:
        "200":
          description: Debug logging successfully enabled
          content:
            application/json:
              schema:
                type: object
                required:
                  - status
                  - timestamp
                properties:
                  status:
                    type: string
                    enum: [enabled, already_enabled]
                    example: "enabled"
                  message:
                    type: string
                    example: "Debug logging enabled successfully"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-11-01T10:30:00Z"
                  expires_at:
                    type: string
                    format: date-time
                    description: When logging will auto-disable (if TTL specified)
                    example: "2025-11-01T11:30:00Z"
                  level:
                    type: string
                    example: "debug"
              examples:
                with_ttl:
                  summary: Enabled with TTL
                  value:
                    status: "enabled"
                    message: "Debug logging enabled for 1 hour"
                    timestamp: "2025-11-01T10:30:00Z"
                    expires_at: "2025-11-01T11:30:00Z"
                    level: "debug"
                without_ttl:
                  summary: Enabled without TTL
                  value:
                    status: "enabled"
                    message: "Debug logging enabled (manual disable required)"
                    timestamp: "2025-11-01T10:30:00Z"
                    level: "debug"

        "400":
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
              example:
                error: "validation_error"
                message: "Field 'ttl' must be between 60 and 86400"

        "401":
          description: Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

        "403":
          description: Insufficient permissions
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

        "500":
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT bearer token in Authorization header

  schemas:
    Error:
      type: object
      description: Standard error response
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error code
          example: "validation_error"
        message:
          type: string
          description: Human-readable error message
          example: "Invalid input parameters"
        details:
          type: object
          description: Additional error details (optional)
          additionalProperties: true
        trace_id:
          type: string
          description: Request trace ID for support
          example: "abc-123-def-456"
